<h3 class="page-title">Publicar una Oferta / Demanda</h3>

<div id="ofer1">
	<h3 class="paso-title"><em>1</em> Defina tipo y a quien va dirigida</h3>

	<div>
	
    <div id="publicar-paso1a" class="publicar-seccion">
        <h4><em>a</em> ¿Es una <strong>Oferta</strong> o una <strong>Demanda</strong>?</h4>

    	<p id="opciones-oferta">
    	  <span><label id="check-ofertas"><input type="radio" name="tipo" value="oferta" checked="checked"> Oferta </label></span>
    	  <span><label id="check-demandas"><input type="radio" name="tipo" value="demanda"> Demanda </label></span>
    	</p>
	
    </div><!-- /#publicar-paso1a -->
    
    <div id="publicar-paso1b" class="publicar-seccion">
    	<h4><em>b</em> Defina las palabras clave que desea de las empresas que se van a seleccionar. Puede dejarlo vacío.</h4>

    	<div class="demo">

        	<p class="busqueda-principal">

            	<input id="busca" name="busqueda" size="30" type="text" />

        	</p>

    		<script>
    		<%= Bazarcms::Empresasdato.listaRE %>
    		<%= Bazarcms::Empresasdato.listaRD %>

    		$(function() {
    			$( "#slider-range" ).slider({
    				range: true,
    				min: 0,
    				max: maxRE,
    				values: [ 0, maxRE ],
    				slide: function( event, ui ) {
    					$( "#empleados" ).val( "Entre: " + listaRE[ui.values[ 0 ]] + " y " + listaRE2[ui.values[ 1 ]]  );
    					$( "#empleados2" ).val( ui.values[ 0 ] + "+" + ui.values[ 1 ] );
    				}
    			});
    			$( "#empleados" ).val( "Todos");
    			$( "#empleados2" ).val( "0+"+maxRE);


    			$( "#slider-range2" ).slider({
    				range: true,
    				min: 0,
    				max: maxRD,
    				values: [ 0, maxRD ],
    				slide: function( event, ui ) {
    					$( "#ventas" ).val( "Entre: " + listaRD[ui.values[ 0 ]] + " y " + listaRD2[ui.values[ 1 ]] );
    					$( "#ventas2" ).val( ui.values[ 0 ] + "+" + ui.values[ 1 ] );
    				}
    			});

    			$( "#compras" ).val( "Todos");
    			$( "#compras2" ).val( "0+"+maxRD);

    			$( "#ventas" ).val( "Todos");
    			$( "#ventas2" ).val( "0+"+maxRD);

    			$( "#slider-range3" ).slider({
    				range: true,
    				min: 0,
    				max: maxRD,
    				values: [ 0, maxRD ],
    				slide: function( event, ui ) {
    					$( "#compras" ).val( "Entre: " + listaRD[ui.values[ 0 ]] + " y " + listaRD2[ui.values[ 1 ]] );
    					$( "#compras2" ).val( ui.values[ 0 ] + "+" + ui.values[ 1 ] );
    				}
    			});


    			$( "#slider-range4" ).slider({
    				range: true,
    				min: 0,
    				max: maxRD,
    				values: [ 0, maxRD ],
    				slide: function( event, ui ) {
    					$( "#resultados" ).val( "Entre: " + listaRD[ui.values[ 0 ]] + " y " + listaRD2[ui.values[ 1 ]] );
    					$( "#resultados2" ).val( ui.values[ 0 ] + "+" + ui.values[ 1 ] );
    				}
    			});
    			$( "#resultados" ).val( "Todos");
    			$( "#resultados2" ).val( "0+"+maxRD);


    		});


    		</script>
    		
		</div><!-- /.demo -->

    </div><!-- /#publicar-paso1b -->

    <div id="publicar-paso1c" class="publicar-seccion">
        <h4><em>c</em> Seleccione los sectores.</h4>

    	<div id="filtro-perfiles">
        	<table cellspacing="0" class="tabla">
        		<tr><th>Ofrecen:</th><th>Empresas que sean de estos sectores</th></tr>
        		<tr>
        			<td valign="top" style="width: 420px;">
        			<form action="#loquesea" id="perfiles-ofertas-form">
        			 	<label for="query1">Buscar en sectores</label> <input type="text" name="q" id="query1" />
        			 </form>
        			 <input type="hidden" id="pofertan" style="border:0; color:#f6931f; font-weight:bold;" />
        			</td>
        			<td valign="top" >
        			<div id="filtroofertan">
        				<p>Seleccione uno o varios sectores en la caja de búsqueda.</p>
        				<p><b>Solo</b> las empresas que estén en <b>alguno</b> de estos sectores.</p>
        			</div>
        			</td>
        		</tr>
        	</table>

        	<table cellspacing="0" class="tabla">
        		<tr><th>Demandan:</th><th>Empresas que sean de estos sectores</th></tr>
        		<tr>
        			<td valign="top" style="width: 420px;">
        			<form action="#loquesea" id="perfiles-demandas-form" >
        			 	<label for="query2">Buscar en sectores</label> <input type="text" name="q" id="query2" />
        			 </form>
        			 <input type="hidden" id="pdemandan" style="border:0; color:#f6931f; font-weight:bold;" />
        			</td>
        			<td valign="top">
        				<div id="filtrodemandan">
        					<p>Seleccione uno o varios sectores en la caja de búsqueda.</p>
        					<p><b>Solo<b/> las empresas que estén en <b>alguno</b> de estos sectores.</p>
        				</div>
        			</td>
        		</tr>
        	</table>

    	</div><!-- /#filtro-perfiles -->

    	<script type="text/javascript">
    	 //<![CDATA[

    	var a1;
    	var a2;
    	var tot1 = 0;
    	var tot2 = 0;
    	var lis1 = [];
    	var lab1 = [];
    	var ayuda1 = [];
    	var html1 = "";
    	var lis2 = [];
    	var lab2 = [];
    	var ayuda2 = [];
    	var html2 = "";

    	function borraofertan(cual) {
    		var ii;
    		if (cual == 0 && tot1 == 0) {
    			tot1 = 0;
    		}
    		else {

    			var ii;
    			for (ii = cual; ii < tot1 -1; ii++) {
    				lis1[ii] = lis1[ii+1];
    				lab1[ii] = lab1[ii+1];
    				ayuda1[ii] = ayuda1[ii+1];
    			}
    			tot1 = tot1 - 1;

    		}
    		pintaofertan();
    	};

    	function pintaofertan() {


    		if (tot1 == 0) {
    			html1 = "";
    			$('#filtroofertan').html("<p>Seleccione uno o varios sectores en la caja de búsqueda</p>");
    		}
    		else {
    			html1 = "";
    			bus = "";
    			var ii = 0;
    			for (ii = 0; ii < tot1; ii++) {
    				html1 += '<div class="perfil">';
    				html1 += '	<div class="nombre-perfil">'+lab1[ii]+'</div>';
    				html1 += "<span class='opciones-perfil'><img title='Ver Descripción' src='/images/help.png' border='0' onclick=\"$('#O"+lis1[ii]+"\').slideToggle(250);\">";
    				html1 += " <img src='/images/papelera.png' border='0' onclick='borraofertan("+ii+");'></span>";
    				html1 += '<div class="descripcion-perfil" id="O'+lis1[ii]+'" style="display:none">';
    	    		html1 += '<p>'+ayuda1[ii]+'</p>';
    	    		html1 += "<a class='ocultar-link' href='#' onclick=\"$('#O"+lis1[ii]+"\').slideToggle(250);\">Ocultar la descripción</a>";
    	    		html1 += "</div>";
    				html1 += "</div>";

    				bus += lis1[ii]+","
    			}
    			$('#filtroofertan').html(html1);

    			$('#pofertan').val(bus);
    		}
    	};


    	function borrademandan(cual) {
    		var ii;
    		if (cual == 0 && tot2 == 0) {
    			tot2 = 0;
    		}
    		else {

    			var ii;
    			for (ii = cual; ii < tot2 -1; ii++) {
    				lis2[ii] = lis2[ii+1];
    				lab2[ii] = lab2[ii+1];
    				ayuda2[ii] = ayuda2[ii+1]
    			}
    			tot2 = tot2 - 1;

    		}
    		pintademandan();
    	};

    	function pintademandan() {

    		if (tot2 == 0) {
    			html2 = "";
    			$('#filtrodemandan').html("<p>Seleccione uno o varios sectores en la caja de búsqueda</p>");
    		}
    		else {
    			html2 = "";
    			bus = "";
    			var ii = 0;
    			for (ii = 0; ii < tot2; ii++) {


    				html2 += '<div class="perfil">';
    				html2 += '	<div class="nombre-perfil">'+lab2[ii]+'</div>';
    				html2 += "<span class='opciones-perfil'><img title='Ver Descripción' src='/images/help.png' border='0' onclick=\"$('#D"+lis2[ii]+"\').slideToggle(250);\">";
    				html2 += " <img src='/images/papelera.png' border='0' onclick='borrademandan("+ii+");'></span>";
    				html2 += '<div class="descripcion-perfil" id="D'+lis2[ii]+'" style="display:none">';
    	    		html2 += '<p>'+ayuda2[ii]+'</p>';
    	    		html2 += "<a class='ocultar-link' href='#' onclick=\"$('#D"+lis2[ii]+"\').slideToggle(250);\">Ocultar la descripción</a>";
    	    		html2 += "</div>";
    				html2 += "</div>";

    				bus += lis2[ii]+",";
    			}
    			$('#filtrodemandan').html(html2);

    			$('#pdemandan').val(bus);
    		}
    	};

    	jQuery(function() {

    		var options = {
    		  width: 300,
    		  delimiter: /(,|;)\s*/,
    		  deferRequestBy: 150, //miliseconds
    		  params: { tipo: 'O' },
    		  source: "/bazarcms/busquedaperfiles.json",
    		  minLength: 2,
    		  select: function(event, ui) {

    			var esta = 0;

    			for (ii = 0; ii < tot1; ii++) {
    				if (lis1[ii] === ui.item.id) {
    					esta = 1;
    				}
    			}
    			if (!esta) {
    				lis1[tot1] = ui.item.id;
    				lab1[tot1] = ui.item.label;
    				ayuda1[tot1] = ui.item.ayuda;
    				tot1 += 1;
    			}

    			pintaofertan();
    			$("#query1").val("");

    			return false;
    		  },
    		  noCache: false //set to true, to disable caching
    		};



    		a1 = $('#query1').autocomplete(options);

    		var options2 = {
    		  width: 300,
    		  delimiter: /(,|;)\s*/,
    		  deferRequestBy: 150, //miliseconds
    		  params: { tipo: 'O' },
    		  source: "/bazarcms/busquedaperfiles.json",
    		  minLength: 2,
    		  select: function(event, ui) {

    			var esta = 0;

    			for (ii = 0; ii < tot2; ii++) {
    				if (lis2[ii] === ui.item.id) {
    					esta = 1;
    				}
    			}
    			if (!esta) {
    				lis2[tot2] = ui.item.id;
    				lab2[tot2] = ui.item.label;
    				ayuda2[tot2] = ui.item.ayuda;
    				tot2 += 1;
    			}

    			$("#query2").val("");
    			pintademandan();

    			return false;
    		  },
    		  noCache: false //set to true, to disable caching
    		};

    		a2 = $('#query2').autocomplete(options2);

    	    $('#query1').keypress(function (e) {
    	        var code = null;
    	        code = (e.keyCode ? e.keyCode : e.which);
    	        return (code == 13) ? false : true;
    	    });

    	    $('#query2').keypress(function (e) {
    	        var code = null;
    	        code = (e.keyCode ? e.keyCode : e.which);
    	        return (code == 13) ? false : true;
    	    });

    	});

    	//]]>
    	</script>

    </div><!-- /#publicar-paso1c -->

    <div id="publicar-paso1d" class="publicar-seccion">

        <h4><em>d</em> Solo empresas que tengan presencia en estos Países</h4>

    	<div id="filtro-pais">

    		<table cellspacing="0" class="tabla">
    			<tr><th>Países:</th><th>Países Seleccionados:</th></tr>
    			<tr>
    				<td valign="top" style="width: 420px;">
    				<form action="#loquesea" id="paises-form" >
    	                <label for="query3">Buscar Países</label>
    	                <input type="text" name="q" id="query3" />
    				 </form>
    				</td>
    				<td>
    					<div id="mispaises">
    						<p>Seleccione uno o varios países en la caja de búsqueda</p>
    					</div>
    				</td>
    			</tr>
    		</table>


    	</div><!-- /#filtro-pais -->

    	<script type="text/javascript">
    	 //<![CDATA[


    	var tot3 = 0;
    	var lis3 = [];
    	var lab3 = [];
    	var ayuda3 = [];
    	var html3 = "";

    	function borrapaises(cual) {
    		var ii;
    		if (cual == 0 && tot3 == 0) {
    			tot3 = 0;
    		}
    		else {

    			var ii;
    			for (ii = cual; ii < tot3 -1; ii++) {
    				lis3[ii] = lis3[ii+1];
    				lab3[ii] = lab3[ii+1];
    				ayuda3[ii] = ayuda3[ii+1]
    			}
    			tot3 = tot3 - 1;
    		}
    		pintapaises();
    	};

    	function pintapaises() {

    		if (tot3 == 0) {
    			html3 = "";
    			$('#mispaises').html("<p>Seleccione uno o varios países en la caja de búsqueda.</p><p>Puedes buscar también por código de País Ej: GB . La búsqueda es por el nombre internacional. Ej: Francia -> France.</p>");
    		}
    		else {
    			html3 = "";
    			bus = "";
    			var ii = 0;
    			for (ii = 0; ii < tot3; ii++) {


    				html3 += '<div class="perfil">';
    				html3 += '	<div class="nombre-perfil">'+lab3[ii]+'</div>';
    				html3 += "<span class='opciones-perfil'><img title='Ver Descripción' src='/images/help.png' border='0' onclick=\"$('#P"+lis3[ii]+"\').slideToggle(250);\">";
    				html3 += " <img src='/images/papelera.png' border='0' onclick='borrapaises("+ii+");'></span>";
    				html3 += '<div class="descripcion-perfil" id="P'+lis3[ii]+'" style="display:none">';
    	    		html3 += '<p>'+ayuda3[ii]+'</p>';
    	    		html3 += "<a class='ocultar-link' href='#' onclick=\"$('#P"+lis3[ii]+"\').slideToggle(250);\">Ocultar la descripción</a>";
    	    		html3 += "</div>";
    				html3 += "</div>";

    				bus += lis3[ii]+",";
    			}
    			$('#mispaises').html(html3);

    			$('#ppaises').val(bus);
    		}
    	};

    	jQuery(function() {

    		var options = {
    		  width: 300,
    		  delimiter: /(,|;)\s*/,
    		  deferRequestBy: 150, //miliseconds
    		  params: { tipo: 'O' },
    		  source: "/busquedapaises.json",
    		  minLength: 2,
    		  select: function(event, ui) {

    			var esta = 0;

    			for (ii = 0; ii < tot3; ii++) {
    				if (lis3[ii] === ui.item.id) {
    					esta = 1;
    				}
    			}
    			if (!esta) {
    				lis3[tot3] = ui.item.id;
    				lab3[tot3] = ui.item.label;
    				ayuda3[tot3] = ui.item.ayuda;
    				tot3 += 1;
    			}

    			pintapaises();
    			$("#query3").val("");

    			return false;
    		  },
    		  noCache: false //set to true, to disable caching
    		};


    		a1 = $('#query3').autocomplete(options);

    	    $('#query3').keypress(function (e) {
    	        var code = null;
    	        code = (e.keyCode ? e.keyCode : e.which);
    	        return (code == 13) ? false : true;
    	    });

    	});


    	//]]>
    	</script>

    </div><!-- /#publicar-paso1d -->

    <div id="publicar-paso1e" class="publicar-seccion">

    	<h4><em>e</em> Empresas que cuyos datos cumplan estas condiciones.</h4>

    	<div id="filtro-datos-economicos">
    	<table border="0" cellspacing="0">
    		<tr>
    			<td width="350px">
    				<label for="empleados">Nº Empleados:</label>

    			</td>
    			<td width="200px">
    				<div id="slider-range"></div>
    			</td>
    			<td>
    	            <input type="text" size="35" id="empleados" readonly="readonly" style="border:0; color:#f6931f; font-weight:bold;" />
    	            <input type="hidden" id="empleados2" style="border:0; color:#f6931f; font-weight:bold;" />
    			</td>
    		</tr>
    	</table>

    	<table border="0" cellspacing="0">
    		<tr>
    			<td width="350px">
    				<label for="compras">Compras:</label>
    			</td>
    			<td width="200px">
    				<div id="slider-range3"></div>
    			</td>
    			<td>
    	            <input type="text" size="35" id="compras" readonly="readonly" style="border:0; color:#f6931f; font-weight:bold;" />
    	            <input type="hidden" id="compras2" style="border:0; color:#f6931f; font-weight:bold;" />
    			</td>
    		</tr>
    	</table>

    	<table border="0" cellspacing="0">
    		<tr>
    			<td width="350px">
    				<label for="ventas">Ventas:</label>
    			</td>
    			<td width="200px">
    				<div id="slider-range2"></div>
    			</td>
    	        <td>
    	            <input type="text" size="35" id="ventas" readonly="readonly" style="border:0; color:#f6931f; font-weight:bold;" />
    	            <input type="hidden" id="ventas2" style="border:0; color:#f6931f; font-weight:bold;" />
    			</td>
    		</tr>
    	</table>


    	<table border="0" cellspacing="0">
    		<tr>
    			<td width="350px">
    				<label for="resultados">Resultados:</label>
    			</td>
    			<td width="200px">
    				<div id="slider-range4"></div>
    			</td>
    			<td>
    	            <input type="text" size="35" id="resultados" readonly="readonly" style="border:0; color:#f6931f; font-weight:bold;" />
    	            <input type="hidden" id="resultados2" style="border:0; color:#f6931f; font-weight:bold;" />
    			</td>
    		</tr>
    	</table>
    	</div><!-- /#filtro-datos-economicos -->

    </div><!-- /#publicar-paso1e -->


    <div id="navegar-publicar">
		<h3 class="paso-title"><em>2</em> Compruebe el número de empresas seleccionadas.</h3>
	   	<a class="publicar-submit" href="#navegar-publicar" onclick="Estimar(); ">Estimar empresas con estas condiciones.</a>
	</div>
	
 
		<div>

			<div id="estado" style="display: none; width:550px;" >
				<div id="progressbar" style="display: none"></div>
				<br/>
				<div id="estadotexto" style="display: none"></div>
			</div>

			<div id="estimadas">
			</div><!-- /#resultados-->

		</div>

	 <div id="navegar-publicar">

    	<a href="#" onclick="$('#ofer1').toggle('slow'); $('#ofer2').toggle('slow'); ">Siguiente Paso: Datos de la oferta</a>
    </div>
    
</div><!-- /#ofer1 -->

<div id="ofer2" style="display:none">
	<h3 class="paso-title"><em>2</em> Datos</h3>

    <div id="navegar-publicar">
        <a href="#" onclick="$('#ofer2').toggle('slow'); $('#ofer1').toggle('slow'); ">Anterior</a>
       	<a class="publicar-submit" href="#" onclick="$('#ofer2').toggle('slow'); $('#ofer3').toggle('slow'); ">Confirmar el envio</a>
    </div>


</div><!-- /#ofer2 -->

<div id="ofer3" style="display:none">
	<h3 class="paso-title"><em>3</em> Confirmación y envío</h3>

    <div id="navegar-publicar">
    	<a href="#" onclick="$('#ofer3').toggle('slow'); $('#ofer2').toggle('slow'); ">Anterior</a>
    	<a class="publicar-submit" href="#" onclick="$('#ofer1').toggle('slow'); $('#ofer2').toggle('slow'); ">Envio</a>
    </div>

</div><!-- /#ofer3 -->


<script type="text/javascript">
 //<![CDATA[

function Estimar() {
	
		s = $("#busca").val();
		if (s.length == 0) {
			s = '*';
		}
		s = s.replace(/ /g, "+");

		emple = $("#empleados2").val();
		ventas = $("#ventas2").val();
		compras = $("#compras2").val();
		resultados = $("#resultados2").val();
		pofertan = $("#pofertan").val();
		pdemandan = $("#pdemandan").val();

		$("#estado").show();
		$("#progressbar").show();
		$("#estadotexto").show();

		$("#estadotexto").html('Buscando las empresas a las que se va a enviar la oferta');

		$.ajax({
		  async:true, 
		  url: '/bazarcms/enviabusqueda?q='+s+'&qe='+emple+'&qv='+ventas+'&qc='+compras+'&qr='+resultados+'&pofertan='+pofertan+'&pdemandan='+pdemandan+'&display=total', 
		  success: function(data) {
		    $('#estimadas').html(data);
			clearInterval(actualiza);

			$('#progressbar').hide();
			$("#progressbar").progressbar({ value: 0});

			$('#estadotexto').hide();
			$("#estadotexto").html('');

			clearInterval(actualiza);
		  }
		});

		var actualiza = setInterval(function(){
			
			$.get('/bazarcms/estadobusqueda', function(data) {
				$("#progressbar").progressbar({ value: (data[0].empresasconsulta.total_respuestas * 100) / data[0].empresasconsulta.total_consultas});
				$("#estadotexto").html(data[0].empresasconsulta.total_resultados +' Empresas de '+ data[0].empresasconsulta.total_respuestas +' Bazares');
			});
	     },1000);

		return false;
};

$(function() {
	$( "#progressbar" ).progressbar({ value: 0});
});


//]]>
</script>

<style>
	.ui-progressbar-value { background-image: url(/images/pbar-ani.gif); }
</style>





